{"ast":null,"code":"const Query = require('./model/Query');\nconst axios = require('axios');\nconst Cache = require('lru');\nconst Queue = require('promise-queue');\nconst defaultConcurrency = 1;\nconst defaultMaxQueueLength = Infinity;\nconst cacheSize = 100000;\n\n// Context is shared across different modules\nconst SingletonContext = {\n  queue: new Queue(defaultConcurrency, defaultMaxQueueLength),\n  cache: new Cache(cacheSize)\n};\nclass Nominatim {\n  constructor(options, queryOptions) {\n    const defaultOptions = {\n      secure: false,\n      // enables ssl\n      host: 'nominatim.openstreetmap.org',\n      customUrl: undefined,\n      // if you want to host your own nominatim\n      cache: true,\n      delay: 1000 // Delay between requests\n    };\n    const queryDefaults = {\n      format: 'json',\n      limit: 3\n    };\n    this.options = Object.assign({}, defaultOptions, options);\n    this.queryDefaults = Object.assign({}, queryDefaults, queryOptions);\n  }\n  static setupCache(size) {\n    // Just to be sure the memory will be freed\n    if (SingletonContext.cache) {\n      SingletonContext.cache.clear();\n    }\n    SingletonContext.cache = new Cache(size);\n  }\n  static setupQueue(concurrency, maxQueueLength) {\n    SingletonContext.queue = new Queue(concurrency || defaultConcurrency, maxQueueLength || defaultMaxQueueLength);\n  }\n  protocol(options) {\n    return options.secure ? 'https' : 'http';\n  }\n  buildUrl(options, slug) {\n    if (options.customUrl) {\n      return options.customUrl + slug;\n    }\n    return this.protocol(options) + '://' + options.host + slug;\n  }\n  search(query, options) {\n    // Merge options\n    const opt = Object.assign({}, this.options, options);\n    const url = this.buildUrl(opt, '/search');\n    return this.query(url, query);\n  }\n  reverse(query, options) {\n    // Merge options\n    const opt = Object.assign({}, this.options, options);\n    const url = this.buildUrl(opt, '/reverse');\n    return this.query(url, query);\n  }\n  query(url, query) {\n    const queryObject = Object.assign(new Query(), this.queryDefaults, query);\n    const cacheHitInformation = {\n      hit: false\n    };\n    return SingletonContext.queue.add(() => {\n      const promise = new Promise((resolve, reject) => {\n        let cachedResponse;\n        if (cachedResponse = SingletonContext.cache.get(queryObject.hash())) {\n          cacheHitInformation.hit = true;\n          resolve(cachedResponse);\n          return;\n        }\n        axios.get(url, {\n          params: queryObject.plainObject()\n        }).then(response => {\n          resolve(response.data);\n        }).catch(error => {\n          SingletonContext.cache.remove(queryObject.hash());\n          reject(error);\n        });\n      });\n      const delayedPromise = this.delayPromise(promise, cacheHitInformation);\n\n      // Store promise in cache, resolved promises are self-unwrapping\n      SingletonContext.cache.set(queryObject.hash(), delayedPromise);\n      return delayedPromise;\n    });\n  }\n\n  // This method wraps a promise, it waits after a promise is resolved/rejected\n  // and resolves the outer promise when the remaing time after delayBetweenRequests\n  // has passed. Quite a hack...\n  // ToDo: Replace\n  // Note: Rate limiting is subject to the jasmine tests\n  delayPromise(promise, cacheHitInformation) {\n    const start = new Date();\n    const handleEndedPromise = (action, responseOrError) => {\n      const end = new Date();\n      const timeToWait = this.options.delay - (end - start);\n      const isFromCache = cacheHitInformation.hit;\n      if (timeToWait > 0 && !isFromCache) {\n        setTimeout(() => action(responseOrError), timeToWait);\n      } else {\n        action(responseOrError); // immediate resolve\n      }\n    };\n    return new Promise((resolve, reject) => {\n      promise.then((response, query, test) => {\n        handleEndedPromise(resolve, response);\n      }).catch((error, query) => {\n        handleEndedPromise(reject, error);\n      });\n    });\n  }\n}\n\n// Wrapper for those who prefer callbacks\nclass NominatimCallbackWrapper extends Nominatim {\n  search(query, options, callback) {\n    const promise = super.search(query, options);\n    return this.handlePromise(promise, callback);\n  }\n  reverse(query, options, callback) {\n    const promise = super.reverse(query, options);\n    return this.handlePromise(promise, callback);\n  }\n  handlePromise(promise, callback) {\n    if (typeof callback === 'function') {\n      return this.wrapPromiseWithCallback(promise, callback);\n    }\n    return promise;\n  }\n  wrapPromiseWithCallback(promise, callback) {\n    return promise.then((data, query) => callback(undefined, data)).catch((error, query) => callback(error, undefined));\n  }\n}\nNominatim.Nominatim = Nominatim; // hack to have a default and named exports\nNominatim.NominatimCallback = NominatimCallbackWrapper;\nNominatim.NominatimSingletonContext = SingletonContext;\nNominatim.NominatimCache = Cache;\nNominatim.NominatimQueue = Queue;\nmodule.exports = Nominatim;","map":{"version":3,"names":["Query","require","axios","Cache","Queue","defaultConcurrency","defaultMaxQueueLength","Infinity","cacheSize","SingletonContext","queue","cache","Nominatim","constructor","options","queryOptions","defaultOptions","secure","host","customUrl","undefined","delay","queryDefaults","format","limit","Object","assign","setupCache","size","clear","setupQueue","concurrency","maxQueueLength","protocol","buildUrl","slug","search","query","opt","url","reverse","queryObject","cacheHitInformation","hit","add","promise","Promise","resolve","reject","cachedResponse","get","hash","params","plainObject","then","response","data","catch","error","remove","delayedPromise","delayPromise","set","start","Date","handleEndedPromise","action","responseOrError","end","timeToWait","isFromCache","setTimeout","test","NominatimCallbackWrapper","callback","handlePromise","wrapPromiseWithCallback","NominatimCallback","NominatimSingletonContext","NominatimCache","NominatimQueue","module","exports"],"sources":["/media/giada/OS/Users/Asus/OneDrive - Università degli Studi di Catania/_Università/Web Programming/Progetto/progetto/client/node_modules/nominatim-geocoder/index.js"],"sourcesContent":["const Query = require('./model/Query')\n\nconst axios = require('axios')\nconst Cache = require('lru')\nconst Queue = require('promise-queue')\n\nconst defaultConcurrency = 1\nconst defaultMaxQueueLength = Infinity\nconst cacheSize = 100000\n\n// Context is shared across different modules\nconst SingletonContext = {\n  queue: new Queue(defaultConcurrency, defaultMaxQueueLength),\n  cache: new Cache(cacheSize),\n}\n\nclass Nominatim {\n  constructor(options, queryOptions) {\n    const defaultOptions = {\n      secure: false, // enables ssl\n      host: 'nominatim.openstreetmap.org',\n      customUrl: undefined, // if you want to host your own nominatim\n      cache: true,\n      delay: 1000, // Delay between requests\n    }\n\n    const queryDefaults = {\n      format: 'json',\n      limit: 3,\n    }\n\n    this.options = Object.assign({}, defaultOptions, options)\n    this.queryDefaults = Object.assign({}, queryDefaults, queryOptions)\n  }\n\n  static setupCache(size) {\n    // Just to be sure the memory will be freed\n    if (SingletonContext.cache) {\n      SingletonContext.cache.clear()\n    }\n\n    SingletonContext.cache = new Cache(size)\n  }\n\n  static setupQueue(concurrency, maxQueueLength) {\n    SingletonContext.queue = new Queue(\n      concurrency || defaultConcurrency,\n      maxQueueLength || defaultMaxQueueLength)\n  }\n\n\n  protocol(options) {\n    return options.secure ? 'https' : 'http'\n  }\n\n  buildUrl(options, slug) {\n    if (options.customUrl) {\n      return options.customUrl + slug\n    }\n\n    return this.protocol(options) + '://' + options.host + slug\n  }\n\n  search(query, options) {\n    // Merge options\n    const opt = Object.assign({}, this.options, options)\n    const url = this.buildUrl(opt, '/search')\n    return this.query(url, query)\n  }\n\n  reverse(query, options) {\n    // Merge options\n    const opt = Object.assign({}, this.options, options)\n    const url = this.buildUrl(opt, '/reverse')\n    return this.query(url, query)\n  }\n\n  query(url, query) {\n    const queryObject = Object.assign(new Query(), this.queryDefaults, query)\n    const cacheHitInformation = { hit: false }\n\n    return SingletonContext.queue.add(() => {\n      const promise = new Promise((resolve, reject) => {\n        let cachedResponse\n        if (cachedResponse = SingletonContext.cache.get(queryObject.hash())) {\n          cacheHitInformation.hit = true\n          resolve(cachedResponse)\n          return\n        }\n\n        axios.get(url, { params: queryObject.plainObject() })\n          .then((response) => {\n            resolve(response.data)\n          })\n          .catch((error) => {\n            SingletonContext.cache.remove(queryObject.hash())\n            reject(error)\n          })\n      })\n\n      const delayedPromise = this.delayPromise(promise, cacheHitInformation)\n\n      // Store promise in cache, resolved promises are self-unwrapping\n      SingletonContext.cache.set(queryObject.hash(), delayedPromise)\n      return delayedPromise\n    })\n  }\n\n  // This method wraps a promise, it waits after a promise is resolved/rejected\n  // and resolves the outer promise when the remaing time after delayBetweenRequests\n  // has passed. Quite a hack...\n  // ToDo: Replace\n  // Note: Rate limiting is subject to the jasmine tests\n  delayPromise(promise, cacheHitInformation) {\n    const start = new Date()\n\n    const handleEndedPromise = (action, responseOrError) => {\n      const end = new Date()\n\n      const timeToWait = this.options.delay - (end - start)\n      const isFromCache = cacheHitInformation.hit\n\n      if (timeToWait > 0 && !isFromCache) {\n        setTimeout(() => action(responseOrError), timeToWait)\n      } else {\n        action(responseOrError) // immediate resolve\n      }\n    }\n\n    return new Promise((resolve, reject) => {\n      promise.then((response, query, test) => {\n        handleEndedPromise(resolve, response)\n      }).catch((error, query) => {\n        handleEndedPromise(reject, error)\n      })\n    })\n  }\n}\n\n// Wrapper for those who prefer callbacks\nclass NominatimCallbackWrapper extends Nominatim {\n  search(query, options, callback) {\n    const promise = super.search(query, options)\n    return this.handlePromise(promise, callback)\n  }\n\n  reverse(query, options, callback) {\n    const promise = super.reverse(query, options)\n    return this.handlePromise(promise, callback)\n  }\n\n  handlePromise(promise, callback) {\n    if (typeof callback === 'function') {\n      return this.wrapPromiseWithCallback(promise, callback)\n    }\n\n    return promise\n  }\n\n  wrapPromiseWithCallback(promise, callback) {\n    return promise\n      .then((data, query) => callback(undefined, data))\n      .catch((error, query) => callback(error, undefined))\n  }\n}\n\nNominatim.Nominatim = Nominatim // hack to have a default and named exports\nNominatim.NominatimCallback = NominatimCallbackWrapper\nNominatim.NominatimSingletonContext = SingletonContext\nNominatim.NominatimCache = Cache\nNominatim.NominatimQueue = Queue\n\nmodule.exports = Nominatim\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}